Act칰a como un Arquitecto de Software Senior experto en N칩minas (Payroll) y bases de datos SQLAlchemy. 

Tu objetivo es implementar un "Override de Pol칤tica de Gratificaci칩n" a nivel de Empresa. Actualmente, el c치lculo de Renta de 5ta Categor칤a asume gratificaciones estrictamente por ley, pero necesitamos que la empresa pueda forzar voluntariamente la proyecci칩n (1 sueldo, 1/2 sueldo, o nada) sin perder la opci칩n de c치lculo autom치tico.

DEBES MODIFICAR ESTRICTAMENTE LOS SIGUIENTES 4 ARCHIVOS respetando las instrucciones paso a paso mediante programaci칩n defensiva:

1. Modificar `infrastructure/database/models.py`:
- En la clase `Empresa`, a침ade un nuevo campo de tipo Float que permita nulos:
  `factor_proyeccion_grati = Column(Float, nullable=True)`

2. Modificar `presentation/app.py`:
- Busca la lista `_migraciones` (dentro del bloque "AUTO-CREAR TABLAS EN NEON") y a침ade la siguiente sentencia SQL al final de la lista para actualizar la base de datos de forma segura:
  `"ALTER TABLE empresas ADD COLUMN IF NOT EXISTS factor_proyeccion_grati FLOAT",`

3. Modificar `presentation/views/selector_empresa.py`:
- Justo debajo de los imports iniciales, define los siguientes diccionarios de mapeo:
  ```python
  _MAP_GRATI = {
      "Autom치tico (Seg칰n Ley)": None, 
      "Otorgar 1 Sueldo Completo": 1.0, 
      "Otorgar 1/2 Sueldo": 0.5, 
      "No otorgar (0)": 0.0
  }
  _MAP_GRATI_INV = {v: k for k, v in _MAP_GRATI.items()}
En la secci칩n "MODO CREACI칍N DE NUEVA EMPRESA", debajo del selector fecha_acogimiento_sel, a침ade el selector para la interfaz:
pol_grati_sel = st.selectbox("Pol칤tica de Gratificaci칩n (Proyecci칩n 5ta Cat.)", list(_MAP_GRATI.keys()))

En la creaci칩n de la instancia nueva = Empresa(...) dentro de ese mismo bloque, a침ade el nuevo campo:
factor_proyeccion_grati=_MAP_GRATI[pol_grati_sel]

En la secci칩n "MODO EDICI칍N DE EMPRESA", debajo del selector fecha_acogimiento_sel, a침ade:

Python
idx_pg = list(_MAP_GRATI.keys()).index(_MAP_GRATI_INV.get(emp.factor_proyeccion_grati, "Autom치tico (Seg칰n Ley)"))
pol_grati_sel = st.selectbox("Pol칤tica de Gratificaci칩n (Proyecci칩n 5ta Cat.)", list(_MAP_GRATI.keys()), index=idx_pg)
En el bloque de guardado (try: emp.razon_social = razon_social...), a침ade la actualizaci칩n del campo:
emp.factor_proyeccion_grati = _MAP_GRATI[pol_grati_sel]

En la "VISTA NORMAL", busca el bloque donde se actualiza el session_state (dentro de if st.button("游 Seleccionar"...):
Justo debajo de st.session_state['empresa_acogimiento'] = emp.fecha_acogimiento, a침ade:
st.session_state['empresa_factor_grati'] = emp.factor_proyeccion_grati

Modificar presentation/views/calculo_mensual.py (MOTOR CR칈TICO):

Busca dentro de la funci칩n _render_planilla_tab(), justo antes de iniciar el bucle for index, row in df_planilla.iterrows():, e inyecta la siguiente l칩gica para calcular el factor maestro a aplicar:

Python
# --- Determinar factor de gratificaci칩n general para la empresa ---
regimen_empresa_motor = st.session_state.get('empresa_activa_regimen', 'R칠gimen General')
factor_g_manual = st.session_state.get('empresa_factor_grati', None)

if factor_g_manual is not None:
    factor_g = float(factor_g_manual)
else:
    if "Micro Empresa" in regimen_empresa_motor:
        factor_g = 0.0
    elif "Peque침a Empresa" in regimen_empresa_motor:
        factor_g = 0.5
    else:
        factor_g = 1.0
M치s abajo, DENTRO DEL BUCLE principal, busca la secci칩n --- RENTA 5TA CATEGOR칈A ---. Reemplaza todo el bloque actual donde se define proyeccion_gratis por este c칩digo que utiliza el nuevo multiplicador:

Python
proyeccion_gratis = 0.0
if mes_idx <= 6:
    proyeccion_gratis = base_quinta_proyeccion * 2 * factor_g * 1.09
elif mes_idx <= 11:
    proyeccion_gratis = base_quinta_proyeccion * 1 * factor_g * 1.09
Mant칠n estrictamente el resto del c칩digo inalterado, usa indentaci칩n de 4 espacios (est치ndar Python) y asegura el manejo de variables como est치 propuesto. Ejecuta los cambios.